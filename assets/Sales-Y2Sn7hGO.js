import{_ as Y,c as i,a as t,b,d as c,w as _,v as D,k as P,f as G,t as o,F as w,r as k,n as v,g as f,h as p,o as W,j as r}from"./index-1NJw5fJc.js";const X={name:"Sales",setup(){const m=f([{id:"1001",date:new Date("2023-11-10T14:30:00"),customer:{id:1,name:"Roberto Escobar",email:"rober@example.com",phone:"+56 9 1234 5678"},seller:"María González",items:[{id:1,name:"Laptop HP 15-dw1000",sku:"LP-HP-001",price:699990,quantity:1,image:"https://ui-avatars.com/api/?name=Laptop+HP&background=random"},{id:2,name:"Mouse Inalámbrico",sku:"MS-WL-001",price:14990,quantity:2,image:"https://ui-avatars.com/api/?name=Mouse&background=random"}],subtotal:729970,discount:2e4,tax:134894,total:844864,paymentMethod:"credit_card",paymentDetails:{transactionId:"TXN-789456",last4:"4242"},status:"completed",notes:"Cliente solicita factura"}]),e=f({search:"",status:"",startDate:"",endDate:"",paymentMethod:""}),S=f(!1),s=f(null),x=f(1),y=f(10),a=p(()=>m.value.filter(n=>{const l=!e.value.search||n.id.includes(e.value.search)||n.customer?.name&&n.customer.name.toLowerCase().includes(e.value.search.toLowerCase()),d=!e.value.status||n.status===e.value.status;let u=!0;if(e.value.startDate){const h=new Date(e.value.startDate);h.setHours(0,0,0,0),u=u&&new Date(n.date)>=h}if(e.value.endDate){const h=new Date(e.value.endDate);h.setHours(23,59,59,999),u=u&&new Date(n.date)<=h}const J=!e.value.paymentMethod||n.paymentMethod===e.value.paymentMethod;return l&&d&&u&&J}).sort((n,l)=>new Date(l.date)-new Date(n.date))),g=p(()=>{const n=(x.value-1)*y.value,l=n+y.value;return a.value.slice(n,l)}),N=p(()=>Math.ceil(a.value.length/y.value)),T=p(()=>{const n=new Date;return n.setHours(0,0,0,0),m.value.filter(l=>new Date(l.date)>=n&&l.status==="completed").reduce((l,d)=>l+d.total,0)}),V=p(()=>{const n=new Date,l=new Date(n.getFullYear(),n.getMonth(),1);return m.value.filter(d=>new Date(d.date)>=l&&d.status==="completed").reduce((d,u)=>d+u.total,0)}),I=p(()=>m.value.filter(n=>n.status==="pending").length),j=p(()=>{const n=m.value.filter(d=>d.status==="completed");if(n.length===0)return 0;const l=n.reduce((d,u)=>d+u.total,0);return Math.round(l/n.length)}),L=n=>new Intl.NumberFormat("es-CL").format(n),C=n=>new Date(n).toLocaleDateString("es-CL"),M=n=>new Date(n).toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"}),E=n=>`${C(n)} ${M(n)}`,F=n=>({completed:"Completada",pending:"Pendiente",cancelled:"Cancelada"})[n]||n,z=n=>({completed:"bg-success bg-opacity-10 text-success",pending:"bg-warning bg-opacity-10 text-warning",cancelled:"bg-danger bg-opacity-10 text-danger"})[n]||"bg-secondary bg-opacity-10",H=n=>({cash:"Efectivo",credit_card:"Tarjeta de Crédito",debit_card:"Tarjeta de Débito",transfer:"Transferencia"})[n]||n,R=n=>({cash:"bg-success bg-opacity-10 text-success",credit_card:"bg-primary bg-opacity-10 text-primary",debit_card:"bg-info bg-opacity-10 text-info",transfer:"bg-secondary bg-opacity-10 text-secondary"})[n]||"bg-light text-dark",U=()=>{e.value={search:"",status:"",startDate:"",endDate:"",paymentMethod:""},x.value=1},B=n=>{s.value=JSON.parse(JSON.stringify(n)),S.value=!0},q=n=>{console.log("Printing receipt for sale:",n.id),alert(`Imprimiendo recibo para la venta #${n.id}`)},A=n=>{if(confirm(`¿Marcar la venta #${n.id} como completada?`)){const l=m.value.findIndex(d=>d.id===n.id);l!==-1&&(m.value[l].status="completed")}},O=n=>{if(confirm(`¿Estás seguro de cancelar la venta #${n.id}? Esta acción no se puede deshacer.`)){const l=m.value.findIndex(d=>d.id===n.id);l!==-1&&(m.value[l].status="cancelled")}};return W(()=>{const n=new Date;e.value.endDate=n.toISOString().split("T")[0];const l=new Date(n.getFullYear(),n.getMonth(),1);e.value.startDate=l.toISOString().split("T")[0]}),{sales:m,filters:e,showSaleDetails:S,currentSale:s,currentPage:x,itemsPerPage:y,filteredSales:a,paginatedSales:g,totalPages:N,dailySales:T,monthlySales:V,pendingSalesCount:I,averageTicket:j,formatNumber:L,formatDate:C,formatTime:M,formatDateTime:E,getStatusName:F,getStatusClass:z,getPaymentMethodName:H,getPaymentMethodClass:R,resetFilters:U,viewSale:B,printReceipt:q,completeSale:A,confirmCancel:O}}},K={class:"sales-management"},Q={class:"container-fluid"},Z={class:"d-flex justify-content-between align-items-center mb-4"},$={class:"card mb-4"},tt={class:"card-body"},et={class:"row g-3"},st={class:"col-md-3"},nt={class:"input-group"},at={class:"col-md-2"},ot={class:"col-md-3"},lt={class:"input-group"},it={class:"col-md-2"},rt={class:"col-md-2 d-flex align-items-end"},dt={class:"row mb-4"},ct={class:"col-md-3"},mt={class:"card bg-primary bg-opacity-10 border-0"},ut={class:"card-body"},bt={class:"d-flex justify-content-between align-items-center"},gt={class:"mb-0"},vt={class:"col-md-3"},pt={class:"card bg-success bg-opacity-10 border-0"},ft={class:"card-body"},yt={class:"d-flex justify-content-between align-items-center"},ht={class:"mb-0"},_t={class:"col-md-3"},xt={class:"card bg-warning bg-opacity-10 border-0"},St={class:"card-body"},Dt={class:"d-flex justify-content-between align-items-center"},wt={class:"mb-0"},kt={class:"col-md-3"},Ct={class:"card bg-info bg-opacity-10 border-0"},Mt={class:"card-body"},Pt={class:"d-flex justify-content-between align-items-center"},Nt={class:"mb-0"},Tt={class:"card"},Vt={class:"card-body p-0"},It={class:"table-responsive"},jt={class:"table table-hover align-middle mb-0"},Lt={key:0},Et={key:0},Ft={class:"fw-medium"},zt={class:"text-muted"},Ht={key:1,class:"text-muted"},Rt={class:"text-muted"},Ut={class:"text-end fw-medium"},Bt={class:"text-end"},qt={class:"btn-group btn-group-sm"},At=["onClick"],Ot=["onClick"],Jt=["onClick"],Yt=["onClick"],Gt={class:"d-flex justify-content-between align-items-center p-3 border-top"},Wt={class:"text-muted"},Xt={class:"pagination mb-0"},Kt=["onClick"],Qt={class:"modal-dialog modal-lg"},Zt={class:"modal-content"},$t={class:"modal-header"},te={class:"modal-title"},ee={key:0,class:"modal-body"},se={class:"row mb-4"},ne={class:"col-md-6"},ae={class:"mb-1"},oe={class:"mb-1"},le={class:"mb-1"},ie={class:"col-md-6"},re={key:0,class:"mb-1"},de={key:1,class:"mb-1"},ce={key:2,class:"mb-1"},me={key:3,class:"mb-0"},ue={class:"table-responsive mb-4"},be={class:"table"},ge={class:"d-flex align-items-center"},ve={class:"product-image me-2"},pe=["src","alt"],fe={class:"fw-medium"},ye={class:"text-muted"},he={class:"text-center"},_e={class:"text-end"},xe={class:"text-end fw-medium"},Se={class:"text-end"},De={class:"text-end"},we={class:"text-end"},ke={class:"text-end fw-bold"},Ce={class:"row"},Me={class:"col-md-6"},Pe={class:"mb-1"},Ne={key:0,class:"mb-1"},Te={key:1,class:"mb-1"},Ve={class:"col-md-6"},Ie={key:0},je={key:1,class:"text-muted"},Le={class:"modal-footer"},Ee={key:0,class:"modal-backdrop fade show"};function Fe(m,e,S,s,x,y){return r(),i("div",K,[t("div",Q,[t("div",Z,[e[13]||(e[13]=t("div",null,[t("h2",{class:"mb-1"},"Ventas"),t("p",{class:"text-muted mb-0"},"Historial y gestión de ventas")],-1)),t("div",null,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=a=>m.$router.push("/pos"))},[...e[12]||(e[12]=[t("i",{class:"bi bi-plus-lg me-1"},null,-1),c(" Nueva Venta ",-1)])])])]),t("div",$,[t("div",tt,[t("div",et,[t("div",st,[e[15]||(e[15]=t("label",{class:"form-label"},"Buscar",-1)),t("div",nt,[e[14]||(e[14]=t("span",{class:"input-group-text"},[t("i",{class:"bi bi-search"})],-1)),_(t("input",{type:"text",class:"form-control",placeholder:"Buscar ventas...","onUpdate:modelValue":e[1]||(e[1]=a=>s.filters.search=a)},null,512),[[D,s.filters.search]])])]),t("div",at,[e[17]||(e[17]=t("label",{class:"form-label"},"Estado",-1)),_(t("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=a=>s.filters.status=a)},[...e[16]||(e[16]=[t("option",{value:""},"Todos",-1),t("option",{value:"completed"},"Completadas",-1),t("option",{value:"pending"},"Pendientes",-1),t("option",{value:"cancelled"},"Canceladas",-1)])],512),[[P,s.filters.status]])]),t("div",ot,[e[19]||(e[19]=t("label",{class:"form-label"},"Rango de fechas",-1)),t("div",lt,[_(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=a=>s.filters.startDate=a)},null,512),[[D,s.filters.startDate]]),e[18]||(e[18]=t("span",{class:"input-group-text"},"a",-1)),_(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=a=>s.filters.endDate=a)},null,512),[[D,s.filters.endDate]])])]),t("div",it,[e[21]||(e[21]=t("label",{class:"form-label"},"Método de pago",-1)),_(t("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=a=>s.filters.paymentMethod=a)},[...e[20]||(e[20]=[G('<option value="" data-v-382b12bb>Todos</option><option value="cash" data-v-382b12bb>Efectivo</option><option value="credit_card" data-v-382b12bb>Tarjeta de Crédito</option><option value="debit_card" data-v-382b12bb>Tarjeta de Débito</option><option value="transfer" data-v-382b12bb>Transferencia</option>',5)])],512),[[P,s.filters.paymentMethod]])]),t("div",rt,[t("button",{class:"btn btn-outline-secondary w-100",onClick:e[6]||(e[6]=(...a)=>s.resetFilters&&s.resetFilters(...a))},[...e[22]||(e[22]=[t("i",{class:"bi bi-arrow-counterclockwise me-1"},null,-1),c(" Restablecer ",-1)])])])])])]),t("div",dt,[t("div",ct,[t("div",mt,[t("div",ut,[t("div",bt,[t("div",null,[e[23]||(e[23]=t("h6",{class:"text-muted mb-1"},"Ventas Hoy",-1)),t("h3",gt,"$"+o(s.formatNumber(s.dailySales)),1),e[24]||(e[24]=t("small",{class:"text-success"},[t("i",{class:"bi bi-arrow-up"}),c(" 12% vs ayer ")],-1))]),e[25]||(e[25]=t("div",{class:"bg-primary bg-opacity-25 p-3 rounded"},[t("i",{class:"bi bi-cart-check text-primary",style:{"font-size":"1.5rem"}})],-1))])])])]),t("div",vt,[t("div",pt,[t("div",ft,[t("div",yt,[t("div",null,[e[26]||(e[26]=t("h6",{class:"text-muted mb-1"},"Ventas del Mes",-1)),t("h3",ht,"$"+o(s.formatNumber(s.monthlySales)),1),e[27]||(e[27]=t("small",{class:"text-success"},[t("i",{class:"bi bi-arrow-up"}),c(" 8% vs mes anterior ")],-1))]),e[28]||(e[28]=t("div",{class:"bg-success bg-opacity-25 p-3 rounded"},[t("i",{class:"bi bi-graph-up text-success",style:{"font-size":"1.5rem"}})],-1))])])])]),t("div",_t,[t("div",xt,[t("div",St,[t("div",Dt,[t("div",null,[e[29]||(e[29]=t("h6",{class:"text-muted mb-1"},"Ventas Pendientes",-1)),t("h3",wt,o(s.pendingSalesCount),1),e[30]||(e[30]=t("small",{class:"text-warning"},[t("i",{class:"bi bi-exclamation-triangle"}),c(" Necesitan atención ")],-1))]),e[31]||(e[31]=t("div",{class:"bg-warning bg-opacity-25 p-3 rounded"},[t("i",{class:"bi bi-clock-history text-warning",style:{"font-size":"1.5rem"}})],-1))])])])]),t("div",kt,[t("div",Ct,[t("div",Mt,[t("div",Pt,[t("div",null,[e[32]||(e[32]=t("h6",{class:"text-muted mb-1"},"Ticket Promedio",-1)),t("h3",Nt,"$"+o(s.formatNumber(s.averageTicket)),1),e[33]||(e[33]=t("small",{class:"text-success"},[t("i",{class:"bi bi-arrow-up"}),c(" 5% vs mes anterior ")],-1))]),e[34]||(e[34]=t("div",{class:"bg-info bg-opacity-25 p-3 rounded"},[t("i",{class:"bi bi-receipt text-info",style:{"font-size":"1.5rem"}})],-1))])])])])]),t("div",Tt,[t("div",Vt,[t("div",It,[t("table",jt,[e[40]||(e[40]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"ID Venta"),t("th",null,"Cliente"),t("th",null,"Fecha"),t("th",{class:"text-end"},"Total"),t("th",null,"Método de Pago"),t("th",null,"Estado"),t("th",{class:"text-end"},"Acciones")])],-1)),t("tbody",null,[s.filteredSales.length===0?(r(),i("tr",Lt,[...e[35]||(e[35]=[t("td",{colspan:"7",class:"text-center py-4"},[t("div",{class:"text-muted"},[t("i",{class:"bi bi-receipt",style:{"font-size":"2rem"}}),t("p",{class:"mt-2 mb-0"},"No se encontraron ventas")])],-1)])])):b("",!0),(r(!0),i(w,null,k(s.paginatedSales,a=>(r(),i("tr",{key:a.id},[t("td",null,"#"+o(a.id),1),t("td",null,[a.customer?(r(),i("div",Et,[t("div",Ft,o(a.customer.name),1),t("small",zt,o(a.customer.email||"Sin correo"),1)])):(r(),i("span",Ht,"Cliente no registrado"))]),t("td",null,[t("div",null,o(s.formatDate(a.date)),1),t("small",Rt,o(s.formatTime(a.date)),1)]),t("td",Ut,"$"+o(s.formatNumber(a.total)),1),t("td",null,[t("span",{class:v(["badge",s.getPaymentMethodClass(a.paymentMethod)])},o(s.getPaymentMethodName(a.paymentMethod)),3)]),t("td",null,[t("span",{class:v(["badge",s.getStatusClass(a.status)])},o(s.getStatusName(a.status)),3)]),t("td",Bt,[t("div",qt,[t("button",{class:"btn btn-outline-primary",onClick:g=>s.viewSale(a),title:"Ver detalles"},[...e[36]||(e[36]=[t("i",{class:"bi bi-eye"},null,-1)])],8,At),t("button",{class:"btn btn-outline-secondary",onClick:g=>s.printReceipt(a),title:"Imprimir recibo"},[...e[37]||(e[37]=[t("i",{class:"bi bi-printer"},null,-1)])],8,Ot),a.status==="pending"?(r(),i("button",{key:0,class:"btn btn-outline-success",onClick:g=>s.completeSale(a),title:"Marcar como completada"},[...e[38]||(e[38]=[t("i",{class:"bi bi-check-lg"},null,-1)])],8,Jt)):b("",!0),a.status!=="cancelled"?(r(),i("button",{key:1,class:"btn btn-outline-danger",onClick:g=>s.confirmCancel(a),title:"Cancelar venta"},[...e[39]||(e[39]=[t("i",{class:"bi bi-x-lg"},null,-1)])],8,Yt)):b("",!0)])])]))),128))])])]),t("div",Gt,[t("div",Wt," Mostrando "+o(Math.min((s.currentPage-1)*s.itemsPerPage+1,s.filteredSales.length))+" a "+o(Math.min(s.currentPage*s.itemsPerPage,s.filteredSales.length))+" de "+o(s.filteredSales.length)+" ventas ",1),t("nav",null,[t("ul",Xt,[t("li",{class:v(["page-item",{disabled:s.currentPage===1}])},[t("button",{class:"page-link",onClick:e[7]||(e[7]=a=>s.currentPage--)},"Anterior")],2),(r(!0),i(w,null,k(s.totalPages,a=>(r(),i("li",{key:a,class:v(["page-item",{active:s.currentPage===a}])},[t("button",{class:"page-link",onClick:g=>s.currentPage=a},o(a),9,Kt)],2))),128)),t("li",{class:v(["page-item",{disabled:s.currentPage===s.totalPages}])},[t("button",{class:"page-link",onClick:e[8]||(e[8]=a=>s.currentPage++)},"Siguiente")],2)])])])])])]),t("div",{class:v(["modal fade",{"show d-block":s.showSaleDetails}]),tabindex:"-1"},[t("div",Qt,[t("div",Zt,[t("div",$t,[t("h5",te,"Detalles de Venta #"+o(s.currentSale?.id),1),t("button",{type:"button",class:"btn-close",onClick:e[9]||(e[9]=a=>s.showSaleDetails=!1)})]),s.currentSale?(r(),i("div",ee,[t("div",se,[t("div",ne,[e[44]||(e[44]=t("h6",{class:"text-muted"},"Información de la Venta",-1)),t("p",ae,[e[41]||(e[41]=t("strong",null,"Fecha:",-1)),c(" "+o(s.formatDateTime(s.currentSale.date)),1)]),t("p",oe,[e[42]||(e[42]=t("strong",null,"Vendedor:",-1)),c(" "+o(s.currentSale.seller||"No especificado"),1)]),t("p",le,[e[43]||(e[43]=t("strong",null,"Estado:",-1)),t("span",{class:v(["badge",s.getStatusClass(s.currentSale.status)])},o(s.getStatusName(s.currentSale.status)),3)])]),t("div",ie,[e[49]||(e[49]=t("h6",{class:"text-muted"},"Información del Cliente",-1)),s.currentSale.customer?(r(),i("p",re,[e[45]||(e[45]=t("strong",null,"Cliente:",-1)),c(" "+o(s.currentSale.customer.name),1)])):b("",!0),s.currentSale.customer?.email?(r(),i("p",de,[e[46]||(e[46]=t("strong",null,"Email:",-1)),c(" "+o(s.currentSale.customer.email),1)])):b("",!0),s.currentSale.customer?.phone?(r(),i("p",ce,[e[47]||(e[47]=t("strong",null,"Teléfono:",-1)),c(" "+o(s.currentSale.customer.phone),1)])):(r(),i("p",me,[...e[48]||(e[48]=[t("strong",null,"Cliente no registrado",-1)])]))])]),t("div",ue,[t("table",be,[e[54]||(e[54]=t("thead",null,[t("tr",null,[t("th",null,"Producto"),t("th",{class:"text-center"},"Cantidad"),t("th",{class:"text-end"},"Precio Unitario"),t("th",{class:"text-end"},"Subtotal")])],-1)),t("tbody",null,[(r(!0),i(w,null,k(s.currentSale.items,(a,g)=>(r(),i("tr",{key:g},[t("td",null,[t("div",ge,[t("div",ve,[t("img",{src:a.image||`https://ui-avatars.com/api/?name=${encodeURIComponent(a.name||"P")}&background=random`,alt:a.name,class:"rounded",style:{width:"40px",height:"40px","object-fit":"cover"}},null,8,pe)]),t("div",null,[t("div",fe,o(a.name),1),t("small",ye,o(a.sku||"N/A"),1)])])]),t("td",he,o(a.quantity),1),t("td",_e,"$"+o(s.formatNumber(a.price)),1),t("td",xe,"$"+o(s.formatNumber(a.quantity*a.price)),1)]))),128))]),t("tfoot",null,[t("tr",null,[e[50]||(e[50]=t("td",{colspan:"3",class:"text-end"},[t("strong",null,"Subtotal:")],-1)),t("td",Se,"$"+o(s.formatNumber(s.currentSale.subtotal)),1)]),t("tr",null,[e[51]||(e[51]=t("td",{colspan:"3",class:"text-end"},[t("strong",null,"Descuento:")],-1)),t("td",De,"$"+o(s.formatNumber(s.currentSale.discount||0)),1)]),t("tr",null,[e[52]||(e[52]=t("td",{colspan:"3",class:"text-end"},[t("strong",null,"IVA (19%):")],-1)),t("td",we,"$"+o(s.formatNumber(s.currentSale.tax)),1)]),t("tr",null,[e[53]||(e[53]=t("td",{colspan:"3",class:"text-end"},[t("strong",null,"Total:")],-1)),t("td",ke,"$"+o(s.formatNumber(s.currentSale.total)),1)])])])]),t("div",Ce,[t("div",Me,[e[58]||(e[58]=t("h6",{class:"text-muted"},"Método de Pago",-1)),t("p",Pe,[e[55]||(e[55]=t("strong",null,"Tipo:",-1)),t("span",{class:v(["badge",s.getPaymentMethodClass(s.currentSale.paymentMethod)])},o(s.getPaymentMethodName(s.currentSale.paymentMethod)),3)]),s.currentSale.paymentDetails?.transactionId?(r(),i("p",Ne,[e[56]||(e[56]=t("strong",null,"ID Transacción:",-1)),c(" "+o(s.currentSale.paymentDetails.transactionId),1)])):b("",!0),s.currentSale.paymentMethod==="credit_card"||s.currentSale.paymentMethod==="debit_card"?(r(),i("p",Te,[e[57]||(e[57]=t("strong",null,"Tarjeta:",-1)),c(" **** **** **** "+o(s.currentSale.paymentDetails?.last4||"****"),1)])):b("",!0)]),t("div",Ve,[e[59]||(e[59]=t("h6",{class:"text-muted"},"Notas",-1)),s.currentSale.notes?(r(),i("p",Ie,o(s.currentSale.notes),1)):(r(),i("p",je,"Sin notas adicionales"))])])])):b("",!0),t("div",Le,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[10]||(e[10]=a=>s.printReceipt(s.currentSale))},[...e[60]||(e[60]=[t("i",{class:"bi bi-printer me-1"},null,-1),c(" Imprimir Recibo ",-1)])]),t("button",{type:"button",class:"btn btn-primary",onClick:e[11]||(e[11]=a=>s.showSaleDetails=!1)}," Cerrar ")])])])],2),s.showSaleDetails?(r(),i("div",Ee)):b("",!0)])}const He=Y(X,[["render",Fe],["__scopeId","data-v-382b12bb"]]);export{He as default};
