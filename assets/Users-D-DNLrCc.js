import{_ as ke,c as d,a as e,d as g,w as b,v as k,k as L,F as D,r as P,t as i,b as E,l as N,n as A,e as h,A as J,g as v,h as G,o as _e,z as xe,y as W,j as c}from"./index-1NJw5fJc.js";import{M as _,D as V}from"./bootstrap.esm-CITe24HP.js";const Ue={Modal:_,Dropdown:V};window.bootstrap=Ue;const Ce={name:"Users",setup(){const p=v([]),s=v(""),x=v(""),a=v(""),U=v([]),M=v(!1),t=v(1),r=v(10),w=v(!1),y=v(!1),R=v(!1),I=v(!1),S=v(null),X=v(null),Y=v(null),B=v(null),n=v({id:null,name:"",lastName:"",username:"",email:"",phone:"",address:"",role:"user",password:"",password_confirmation:"",avatar:"",isActive:!0,permissions:[]}),q=[{value:"admin",label:"Administrador"},{value:"manager",label:"Gerente"},{value:"cashier",label:"Cajero"},{value:"inventory",label:"Inventario"},{value:"user",label:"Usuario Estándar"}],Z=[{name:"Ventas",permissions:[{key:"sales.view",label:"Ver Ventas"},{key:"sales.create",label:"Crear Ventas"},{key:"sales.edit",label:"Editar Ventas"},{key:"sales.delete",label:"Eliminar Ventas"},{key:"sales.returns",label:"Devoluciones"},{key:"sales.discounts",label:"Aplicar Descuentos"}]},{name:"Productos",permissions:[{key:"products.view",label:"Ver Productos"},{key:"products.create",label:"Crear Productos"},{key:"products.edit",label:"Editar Productos"},{key:"products.delete",label:"Eliminar Productos"},{key:"products.categories",label:"Gestionar Categorías"},{key:"products.import",label:"Importar Productos"},{key:"products.export",label:"Exportar Productos"}]},{name:"Clientes",permissions:[{key:"customers.view",label:"Ver Clientes"},{key:"customers.create",label:"Crear Clientes"},{key:"customers.edit",label:"Editar Clientes"},{key:"customers.delete",label:"Eliminar Clientes"},{key:"customers.credit",label:"Gestionar Créditos"},{key:"customers.notes",label:"Agregar Notas"}]},{name:"Usuarios",permissions:[{key:"users.view",label:"Ver Usuarios"},{key:"users.create",label:"Crear Usuarios"},{key:"users.edit",label:"Editar Usuarios"},{key:"users.delete",label:"Eliminar Usuarios"},{key:"users.roles",label:"Gestionar Roles"},{key:"users.permissions",label:"Gestionar Permisos"}]},{name:"Reportes",permissions:[{key:"reports.sales",label:"Reportes de Ventas"},{key:"reports.inventory",label:"Reportes de Inventario"},{key:"reports.customers",label:"Reportes de Clientes"},{key:"reports.taxes",label:"Reportes de Impuestos"},{key:"reports.export",label:"Exportar Reportes"}]},{name:"Configuración",permissions:[{key:"settings.general",label:"Configuración General"},{key:"settings.taxes",label:"Impuestos"},{key:"settings.payment_methods",label:"Métodos de Pago"},{key:"settings.invoice",label:"Facturación"},{key:"settings.backup",label:"Copia de Seguridad"},{key:"settings.update",label:"Actualizaciones"}]}],C=v({totalUsers:0,activeUsers:0,inactiveUsers:0,suspendedUsers:0,newThisMonth:0}),j=G(()=>p.value.filter(o=>{const l=o.name.toLowerCase().includes(s.value.toLowerCase())||o.email.toLowerCase().includes(s.value.toLowerCase())||o.username.toLowerCase().includes(s.value.toLowerCase()),u=!x.value||o.status===x.value,m=!a.value||o.role===a.value;return l&&u&&m})),O=G(()=>Math.ceil(j.value.length/r.value)),T=G(()=>{const o=(t.value-1)*r.value,l=o+r.value;return j.value.slice(o,l)}),Q=async()=>{try{p.value=[{id:1,name:"Rober",lastName:"Escobar",username:"rescobar",email:"rober.escobar@example.com",phone:"+56912345678",address:"Av. Principal 123, Santiago",role:"admin",avatar:"https://ui-avatars.com/api/?name=Rober+Perez&background=random",status:"active",lastLogin:new Date(Date.now()-36e5*2),permissions:["sales.view","sales.create","products.view","users.view"]},{id:2,name:"María",lastName:"González",username:"mgonzalez",email:"maria.gonzalez@example.com",phone:"+56987654321",address:"Av. El Rosal 5450, Santiago",role:"manager",avatar:"https://ui-avatars.com/api/?name=Maria+Gonzalez&background=random",status:"active",lastLogin:new Date(Date.now()-864e5),permissions:["sales.view","sales.create","products.view","customers.view"]},{id:3,name:"Carlos",lastName:"López",username:"clopez",email:"carlos.lopez@example.com",phone:"+56955556666",address:"Av. Siempreviva 742, Ñuñoa",role:"cashier",avatar:"https://ui-avatars.com/api/?name=Carlos+Lopez&background=random",status:"inactive",lastLogin:new Date(Date.now()-864e5*7),permissions:["sales.view","sales.create"]},{id:4,name:"Ana",lastName:"Martínez",username:"amartinez",email:"ana.martinez@example.com",phone:"+56999998888",address:"Av. Apoquindo 4500, Las Condes",role:"inventory",avatar:"https://ui-avatars.com/api/?name=Ana+Martinez&background=random",status:"suspended",lastLogin:new Date(Date.now()-864e5*30),permissions:["products.view","products.edit"]},{id:5,name:"Pedro",lastName:"Sánchez",username:"psanchez",email:"pedro.sanchez@example.com",phone:"+56977776666",address:"Av. Vitacura 3567, Vitacura",role:"user",avatar:"https://ui-avatars.com/api/?name=Pedro+Sanchez&background=random",status:"active",lastLogin:new Date(Date.now()-36e5*5),permissions:["sales.view"]},{id:6,name:"Laura",lastName:"Ramírez",username:"lramirez",email:"laura.ramirez@example.com",phone:"+56944445555",address:"Av. Tobalaba 1234, Providencia",role:"cashier",avatar:"https://randomuser.me/api/portraits/women/33.jpg",status:"active",lastLogin:new Date(Date.now()-36e5),permissions:["sales.view","sales.create","customers.view"]},{id:7,name:"Roberto",lastName:"Mendoza",username:"rmendoza",email:"roberto.mendoza@example.com",phone:"+56933332222",address:"Av. Providencia 2150, Providencia",role:"inventory",avatar:"https://randomuser.me/api/portraits/men/45.jpg",status:"active",lastLogin:new Date(Date.now()-864e5*2),permissions:["products.view","products.edit","products.categories"]},{id:8,name:"Carolina",lastName:"Rojas",username:"crojas",email:"carolina.rojas@example.com",phone:"+56922221111",address:"Av. Las Condes 12345, Las Condes",role:"manager",avatar:"https://randomuser.me/api/portraits/women/29.jpg",status:"inactive",lastLogin:new Date(Date.now()-864e5*14),permissions:["sales.view","products.view","customers.view","reports.sales"]},{id:9,name:"Diego",lastName:"Silva",username:"dsilva",email:"diego.silva@example.com",phone:"+56911110000",address:"Av. Vitacura 4500, Vitacura",role:"admin",avatar:"https://randomuser.me/api/portraits/men/68.jpg",status:"active",lastLogin:new Date,permissions:["sales.view","sales.create","products.view","products.create","users.view","users.create","reports.sales","settings.general"]},{id:10,name:"Valentina",lastName:"Muñoz",username:"vmunoz",email:"valentina.munoz@example.com",phone:"+56966667777",address:"Av. Apoquindo 3472, Las Condes",role:"cashier",avatar:"https://randomuser.me/api/portraits/women/51.jpg",status:"active",lastLogin:new Date(Date.now()-36e5*3),permissions:["sales.view","sales.create","customers.view"]}],z()}catch(o){console.error("Error fetching users:",o)}},z=()=>{C.value.totalUsers=p.value.length,C.value.activeUsers=p.value.filter(o=>o.status==="active").length,C.value.inactiveUsers=p.value.filter(o=>o.status==="inactive").length,C.value.suspendedUsers=p.value.filter(o=>o.status==="suspended").length,C.value.newThisMonth=Math.floor(Math.random()*5)+1},$=async()=>{if(S.value){I.value=!0;try{p.value=p.value.filter(l=>l.id!==S.value.id),z(),_.getInstance(document.getElementById("deleteModal")).hide(),H("success","Usuario eliminado correctamente")}catch(o){console.error("Error deleting user:",o),H("error","Error al eliminar el usuario")}finally{I.value=!1,S.value=null}}},H=(o,l)=>{alert(`${o.toUpperCase()}: ${l}`)},ee=(o,l="long")=>{if(!o)return"";const u=new Date(o),m={year:"numeric",month:l==="short"?"short":"long",day:"numeric"};return u.toLocaleDateString("es-CL",m)},se=o=>{if(!o)return"";const u=Math.floor((new Date-new Date(o))/1e3),m={año:31536e3,mes:2592e3,semana:604800,día:86400,hora:3600,minuto:60,segundo:1};for(const[f,ye]of Object.entries(m)){const F=Math.floor(u/ye);if(F>=1)return`Hace ${F} ${f}${F===1?"":f==="mes"?"es":"s"}`}return"Hace unos segundos"},ae=o=>{o<1||o>O.value||(t.value=o,window.scrollTo({top:0,behavior:"smooth"}))},te=()=>{s.value="",x.value="",a.value="",t.value=1},oe=()=>{n.value={id:null,name:"",lastName:"",username:"",email:"",phone:"",address:"",role:"user",password:"",password_confirmation:"",avatar:"",isActive:!0,permissions:[]}},le=(o=null)=>{o?(y.value=!0,n.value={id:o.id,name:o.name,lastName:o.lastName||"",username:o.username,email:o.email,phone:o.phone||"",address:o.address||"",role:o.role,password:"",password_confirmation:"",avatar:o.avatar||"",isActive:o.status==="active",permissions:[...o.permissions||[]]}):(y.value=!1,oe()),new _(document.getElementById("userModal")).show()},ne=async()=>{if(!n.value.name||!n.value.email||!n.value.username){alert("Por favor complete los campos obligatorios");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.value.email)){alert("Por favor ingrese un correo electrónico válido");return}if((!y.value||n.value.password)&&n.value.password!==n.value.password_confirmation){alert("Las contraseñas no coinciden");return}if(n.value.password&&n.value.password.length<8){alert("La contraseña debe tener al menos 8 caracteres");return}R.value=!0;try{const l={id:n.value.id||Date.now().toString(),name:n.value.name,lastName:n.value.lastName,username:n.value.username,email:n.value.email,phone:n.value.phone,address:n.value.address,role:n.value.role,status:n.value.isActive?"active":"inactive",avatar:n.value.avatar,permissions:n.value.permissions,createdAt:y.value?p.value.find(m=>m.id===n.value.id)?.createdAt||new Date().toISOString():new Date().toISOString(),updatedAt:new Date().toISOString()};if(y.value){const m=p.value.findIndex(f=>f.id===n.value.id);m!==-1&&(p.value[m]={...p.value[m],...l})}else{const m={id:Math.max(0,...p.value.map(f=>f.id))+1,name:n.value.name,lastName:n.value.lastName,username:n.value.username,email:n.value.email,phone:n.value.phone,address:n.value.address,role:n.value.role,avatar:n.value.avatar||"",status:n.value.isActive?"active":"inactive",lastLogin:null,permissions:[...n.value.permissions]};p.value.unshift(m)}z(),alert(`Usuario ${y.value?"actualizado":"creado"} exitosamente`),_.getInstance(document.getElementById("userModal")).hide()}catch(l){console.error("Error saving user:",l),alert("Ocurrió un error al guardar el usuario")}finally{R.value=!1}},ie=o=>{S.value=o,new _(document.getElementById("deleteModal")).show()},re=async(o,l)=>{try{const u=p.value.find(m=>m.id===o);u&&(u.status=l,z(),alert(`Usuario ${K(l)} exitosamente`))}catch(u){console.error("Error updating user status:",u),alert("Ocurrió un error al actualizar el estado del usuario")}},de=o=>{o.target.checked?U.value=T.value.map(l=>l.id):U.value=[]},ce=()=>{M.value=U.value.length===T.value.length},me=()=>{B.value.click()},ue=o=>{const l=o.target.files[0];if(!l)return;if(!l.type.match("image.*")){alert("Por favor, selecciona un archivo de imagen válido");return}if(l.size>2*1024*1024){alert("La imagen no puede ser mayor a 2MB");return}const u=new FileReader;u.onload=m=>{n.value.avatar=m.target.result},u.readAsDataURL(l)},ve=o=>o.every(l=>n.value.permissions.includes(l.key)),pe=(o,l)=>{const u=l.target.checked,m=o.map(f=>f.key);u?m.forEach(f=>{n.value.permissions.includes(f)||n.value.permissions.push(f)}):n.value.permissions=n.value.permissions.filter(f=>!m.includes(f))},be=o=>{const l=q.find(u=>u.value===o);return l?l.label:o},ge=o=>({admin:"bg-danger bg-opacity-10 text-danger",manager:"bg-warning bg-opacity-10 text-warning",cashier:"bg-info bg-opacity-10 text-info",inventory:"bg-primary bg-opacity-10 text-primary",user:"bg-secondary bg-opacity-10 text-secondary"})[o]||"bg-light text-dark",K=o=>({active:"Activo",inactive:"Inactivo",suspended:"Suspendido"})[o]||o,fe=o=>({active:"bg-success bg-opacity-10 text-success",inactive:"bg-warning bg-opacity-10 text-warning",suspended:"bg-danger bg-opacity-10 text-danger"})[o]||"bg-light text-dark",he=o=>{const l=o.currentTarget;new V(l).show()},we=o=>{const l=o.target.closest(".dropdown");if(l){const u=l.querySelector(".dropdown-toggle");if(u){const m=V.getInstance(u);m&&m.hide()}}};return _e(()=>{X.value=new _(document.getElementById("userModal")),Y.value=new _(document.getElementById("deleteModal")),Q(),xe(()=>{document.querySelectorAll(".dropdown-toggle").forEach(l=>{new V(l)})})}),W([s,x,a],()=>{t.value=1,M.value=!1,U.value=[]}),W(r,()=>{t.value=1}),{users:p,searchQuery:s,statusFilter:x,roleFilter:a,selectedUsers:U,selectAll:M,currentPage:t,itemsPerPage:r,showPassword:w,isEditing:y,isSaving:R,isDeleting:I,userToDelete:S,form:n,availableRoles:q,availablePermissions:Z,stats:C,filteredUsers:j,totalPages:O,paginatedUsers:T,avatarInput:B,fetchUsers:Q,showUserModal:le,saveUser:ne,confirmDeleteUser:ie,deleteUser:$,updateUserStatus:re,toggleSelectAll:de,updateSelectAll:ce,changePage:ae,resetFilters:te,triggerFileUpload:me,handleAvatarUpload:ue,isPermissionGroupChecked:ve,togglePermissionGroup:pe,formatDate:ee,formatTimeAgo:se,getRoleName:be,getRoleBadgeClass:ge,getStatusName:K,getStatusBadgeClass:fe,initDropdown:he,hideDropdown:we}}},De={class:"users-management"},Pe={class:"container-fluid"},Ae={class:"d-flex justify-content-between align-items-center mb-4"},Se={class:"card mb-4"},Ee={class:"card-body"},Me={class:"row g-3"},ze={class:"col-md-4"},Le={class:"input-group"},Ne={class:"col-md-3"},Ve={class:"col-md-3"},Re=["value"],Ie={class:"col-md-2"},je={class:"row mb-4"},Te={class:"col-md-3"},Fe={class:"card bg-primary bg-opacity-10 border-0 h-100"},Ge={class:"card-body"},Be={class:"d-flex justify-content-between align-items-center"},qe={class:"mb-0"},Oe={class:"mt-2"},Qe={class:"text-success"},He={class:"col-md-3"},Ke={class:"card bg-success bg-opacity-10 border-0 h-100"},Je={class:"card-body"},We={class:"d-flex justify-content-between align-items-center"},Xe={class:"mb-0"},Ye={class:"mt-2"},Ze={class:"text-muted"},$e={class:"col-md-3"},es={class:"card bg-warning bg-opacity-10 border-0 h-100"},ss={class:"card-body"},as={class:"d-flex justify-content-between align-items-center"},ts={class:"mb-0"},os={class:"mt-2"},ls={class:"text-muted"},ns={class:"col-md-3"},is={class:"card bg-danger bg-opacity-10 border-0 h-100"},rs={class:"card-body"},ds={class:"d-flex justify-content-between align-items-center"},cs={class:"mb-0"},ms={class:"mt-2"},us={class:"text-muted"},vs={class:"card"},ps={class:"card-body p-0"},bs={class:"table-responsive"},gs={class:"table table-hover align-middle mb-0"},fs={class:"table-light"},hs={class:"ps-4"},ws={class:"form-check"},ys={key:0},ks={class:"ps-4"},_s={class:"form-check"},xs=["value"],Us={class:"d-flex align-items-center"},Cs={class:"avatar me-3"},Ds=["src","alt"],Ps={class:"fw-medium"},As={class:"text-muted"},Ss={key:0},Es={class:"text-muted"},Ms={key:1,class:"text-muted"},zs={class:"text-end pe-4"},Ls={class:"dropdown"},Ns=["id"],Vs=["aria-labelledby"],Rs=["onClick"],Is={key:0},js=["onClick"],Ts={key:1},Fs=["onClick"],Gs={key:2},Bs=["onClick"],qs={key:3},Os=["onClick"],Qs=["onClick"],Hs={key:0,class:"d-flex justify-content-between align-items-center p-3 border-top"},Ks={class:"text-muted"},Js={"aria-label":"Page navigation"},Ws={class:"pagination mb-0"},Xs=["onClick"],Ys={class:"d-flex align-items-center"},Zs={class:"modal fade",id:"userModal",tabindex:"-1","aria-hidden":"true"},$s={class:"modal-dialog modal-lg"},ea={class:"modal-content"},sa={class:"modal-header"},aa={class:"modal-title"},ta={class:"modal-body"},oa={class:"row"},la={class:"col-md-4 text-center mb-4"},na={class:"position-relative d-inline-block"},ia=["src","alt"],ra={class:"col-md-8"},da={class:"row g-3"},ca={class:"col-md-6"},ma={class:"col-md-6"},ua={class:"col-md-6"},va={class:"input-group"},pa={class:"col-md-6"},ba={class:"col-md-6"},ga={class:"col-md-6"},fa=["value"],ha={class:"col-12"},wa={class:"col-md-6"},ya={class:"input-group"},ka=["type","required","minlength"],_a={key:0,class:"text-muted"},xa={class:"col-md-6"},Ua=["type","required","disabled"],Ca={class:"col-12"},Da={class:"form-check form-switch"},Pa={class:"form-check-label",for:"statusSwitch"},Aa={class:"mt-4"},Sa={class:"row"},Ea={class:"card h-100"},Ma={class:"card-header bg-light py-2"},za={class:"form-check"},La=["id","checked","onChange"],Na=["for"],Va={class:"card-body p-2"},Ra={class:"form-check"},Ia=["id","value"],ja=["for"],Ta={class:"modal-footer"},Fa=["disabled"],Ga={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Ba={class:"modal fade",id:"deleteModal",tabindex:"-1","aria-hidden":"true"},qa={class:"modal-dialog"},Oa={class:"modal-content"},Qa={class:"modal-body"},Ha={class:"modal-footer border-0"},Ka=["disabled"],Ja={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"};function Wa(p,s,x,a,U,M){return c(),d("div",De,[e("div",Pe,[e("div",Ae,[s[30]||(s[30]=e("div",null,[e("h2",{class:"mb-1"},"Usuarios"),e("p",{class:"text-muted mb-0"},"Gestión de usuarios y permisos del sistema")],-1)),e("div",null,[e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=t=>a.showUserModal())},[...s[29]||(s[29]=[e("i",{class:"bi bi-plus-lg me-1"},null,-1),g(" Nuevo Usuario ",-1)])])])]),e("div",Se,[e("div",Ee,[e("div",Me,[e("div",ze,[e("div",Le,[s[31]||(s[31]=e("span",{class:"input-group-text bg-transparent"},[e("i",{class:"bi bi-search"})],-1)),b(e("input",{type:"text",class:"form-control",placeholder:"Buscar usuarios...","onUpdate:modelValue":s[1]||(s[1]=t=>a.searchQuery=t)},null,512),[[k,a.searchQuery]])])]),e("div",Ne,[b(e("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=t=>a.statusFilter=t)},[...s[32]||(s[32]=[e("option",{value:""},"Todos los estados",-1),e("option",{value:"active"},"Activo",-1),e("option",{value:"inactive"},"Inactivo",-1),e("option",{value:"suspended"},"Suspendido",-1)])],512),[[L,a.statusFilter]])]),e("div",Ve,[b(e("select",{class:"form-select","onUpdate:modelValue":s[3]||(s[3]=t=>a.roleFilter=t)},[s[33]||(s[33]=e("option",{value:""},"Todos los roles",-1)),(c(!0),d(D,null,P(a.availableRoles,t=>(c(),d("option",{key:t.value,value:t.value},i(t.label),9,Re))),128))],512),[[L,a.roleFilter]])]),e("div",Ie,[e("button",{class:"btn btn-outline-secondary w-100",onClick:s[4]||(s[4]=(...t)=>a.resetFilters&&a.resetFilters(...t))},[...s[34]||(s[34]=[e("i",{class:"bi bi-arrow-counterclockwise me-1"},null,-1),g(" Limpiar ",-1)])])])])])]),e("div",je,[e("div",Te,[e("div",Fe,[e("div",Ge,[e("div",Be,[e("div",null,[s[36]||(s[36]=e("h6",{class:"text-muted mb-1"},"Total Usuarios",-1)),e("h3",qe,i(a.stats.totalUsers),1),e("div",Oe,[e("span",Qe,[s[35]||(s[35]=e("i",{class:"bi bi-arrow-up"},null,-1)),g(" "+i(a.stats.newThisMonth)+" este mes ",1)])])]),s[37]||(s[37]=e("div",{class:"bg-primary bg-opacity-25 p-3 rounded"},[e("i",{class:"bi bi-people text-primary",style:{"font-size":"1.5rem"}})],-1))])])])]),e("div",He,[e("div",Ke,[e("div",Je,[e("div",We,[e("div",null,[s[38]||(s[38]=e("h6",{class:"text-muted mb-1"},"Activos",-1)),e("h3",Xe,i(a.stats.activeUsers),1),e("div",Ye,[e("span",Ze,i(Math.round(a.stats.activeUsers/a.stats.totalUsers*100)||0)+"% del total ",1)])]),s[39]||(s[39]=e("div",{class:"bg-success bg-opacity-25 p-3 rounded"},[e("i",{class:"bi bi-check-circle text-success",style:{"font-size":"1.5rem"}})],-1))])])])]),e("div",$e,[e("div",es,[e("div",ss,[e("div",as,[e("div",null,[s[40]||(s[40]=e("h6",{class:"text-muted mb-1"},"Inactivos",-1)),e("h3",ts,i(a.stats.inactiveUsers),1),e("div",os,[e("span",ls,i(Math.round(a.stats.inactiveUsers/a.stats.totalUsers*100)||0)+"% del total ",1)])]),s[41]||(s[41]=e("div",{class:"bg-warning bg-opacity-25 p-3 rounded"},[e("i",{class:"bi bi-pause-circle text-warning",style:{"font-size":"1.5rem"}})],-1))])])])]),e("div",ns,[e("div",is,[e("div",rs,[e("div",ds,[e("div",null,[s[42]||(s[42]=e("h6",{class:"text-muted mb-1"},"Suspendidos",-1)),e("h3",cs,i(a.stats.suspendedUsers),1),e("div",ms,[e("span",us,i(Math.round(a.stats.suspendedUsers/a.stats.totalUsers*100)||0)+"% del total ",1)])]),s[43]||(s[43]=e("div",{class:"bg-danger bg-opacity-25 p-3 rounded"},[e("i",{class:"bi bi-slash-circle text-danger",style:{"font-size":"1.5rem"}})],-1))])])])])]),e("div",vs,[e("div",ps,[e("div",bs,[e("table",gs,[e("thead",fs,[e("tr",null,[e("th",hs,[e("div",ws,[b(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=t=>a.selectAll=t),onChange:s[6]||(s[6]=(...t)=>a.toggleSelectAll&&a.toggleSelectAll(...t))},null,544),[[N,a.selectAll]])])]),s[44]||(s[44]=e("th",null,"Usuario",-1)),s[45]||(s[45]=e("th",null,"Nombre",-1)),s[46]||(s[46]=e("th",null,"Rol",-1)),s[47]||(s[47]=e("th",null,"Último Acceso",-1)),s[48]||(s[48]=e("th",null,"Estado",-1)),s[49]||(s[49]=e("th",{class:"text-end pe-4"},"Acciones",-1))])]),e("tbody",null,[a.filteredUsers.length===0?(c(),d("tr",ys,[...s[50]||(s[50]=[e("td",{colspan:"7",class:"text-center py-5"},[e("div",{class:"text-muted"},[e("i",{class:"bi bi-people display-5 d-block mb-3"}),g(" No se encontraron usuarios que coincidan con los filtros ")])],-1)])])):E("",!0),(c(!0),d(D,null,P(a.paginatedUsers,t=>(c(),d("tr",{key:t.id},[e("td",ks,[e("div",_s,[b(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=r=>a.selectedUsers=r),value:t.id,onChange:s[8]||(s[8]=(...r)=>a.updateSelectAll&&a.updateSelectAll(...r))},null,40,xs),[[N,a.selectedUsers]])])]),e("td",null,[e("div",Us,[e("div",Cs,[e("img",{src:t.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=random`,class:"rounded-circle",alt:t.name},null,8,Ds)]),e("div",null,[e("div",Ps,i(t.username),1),e("small",As,i(t.email),1)])])]),e("td",null,i(t.name),1),e("td",null,[e("span",{class:A(["badge",a.getRoleBadgeClass(t.role)])},i(a.getRoleName(t.role)),3)]),e("td",null,[t.lastLogin?(c(),d("div",Ss,[e("div",null,i(a.formatDate(t.lastLogin,"short")),1),e("small",Es,i(a.formatTimeAgo(t.lastLogin)),1)])):(c(),d("span",Ms,"Nunca"))]),e("td",null,[e("span",{class:A(["badge",a.getStatusBadgeClass(t.status)])},i(a.getStatusName(t.status)),3)]),e("td",zs,[e("div",Ls,[e("button",{class:"btn btn-sm btn-outline-secondary dropdown-toggle",type:"button",id:"userDropdown"+t.id,"data-bs-toggle":"dropdown","data-bs-auto-close":"true","aria-expanded":"false",onClick:s[9]||(s[9]=r=>a.initDropdown(r))},[...s[51]||(s[51]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])],8,Ns),e("ul",{class:"dropdown-menu dropdown-menu-end","aria-labelledby":"userDropdown"+t.id},[e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:h(r=>{a.showUserModal(t),a.hideDropdown(r)},["prevent"])},[...s[52]||(s[52]=[e("i",{class:"bi bi-pencil me-2"},null,-1),g("Editar ",-1)])],8,Rs)]),t.status==="active"?(c(),d("li",Is,[e("a",{class:"dropdown-item",href:"#",onClick:h(r=>{a.updateUserStatus(t.id,"inactive"),a.hideDropdown(r)},["prevent"])},[...s[53]||(s[53]=[e("i",{class:"bi bi-pause me-2"},null,-1),g("Desactivar ",-1)])],8,js)])):(c(),d("li",Ts,[e("a",{class:"dropdown-item",href:"#",onClick:h(r=>{a.updateUserStatus(t.id,"active"),a.hideDropdown(r)},["prevent"])},[...s[54]||(s[54]=[e("i",{class:"bi bi-check-circle me-2"},null,-1),g("Activar ",-1)])],8,Fs)])),t.status!=="suspended"?(c(),d("li",Gs,[e("a",{class:"dropdown-item",href:"#",onClick:h(r=>a.updateUserStatus(t.id,"suspended"),["prevent"])},[...s[55]||(s[55]=[e("i",{class:"bi bi-slash-circle me-2"},null,-1),g("Suspender ",-1)])],8,Bs)])):(c(),d("li",qs,[e("a",{class:"dropdown-item",href:"#",onClick:h(r=>a.updateUserStatus(t.id,"active"),["prevent"])},[...s[56]||(s[56]=[e("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),g("Reactivar ",-1)])],8,Os)])),s[58]||(s[58]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[e("a",{class:"dropdown-item text-danger",href:"#",onClick:h(r=>a.confirmDeleteUser(t),["prevent"])},[...s[57]||(s[57]=[e("i",{class:"bi bi-trash me-2"},null,-1),g("Eliminar ",-1)])],8,Qs)])],8,Vs)])])]))),128))])])]),a.filteredUsers.length>0?(c(),d("div",Hs,[e("div",Ks," Mostrando "+i((a.currentPage-1)*a.itemsPerPage+1)+" a "+i(Math.min(a.currentPage*a.itemsPerPage,a.filteredUsers.length))+" de "+i(a.filteredUsers.length)+" usuarios ",1),e("nav",Js,[e("ul",Ws,[e("li",{class:A(["page-item",{disabled:a.currentPage===1}])},[e("a",{class:"page-link",href:"#",onClick:s[10]||(s[10]=h(t=>a.changePage(a.currentPage-1),["prevent"]))},[...s[59]||(s[59]=[e("i",{class:"bi bi-chevron-left"},null,-1)])])],2),(c(!0),d(D,null,P(a.totalPages,t=>(c(),d("li",{key:t,class:A(["page-item",{active:t===a.currentPage}])},[e("a",{class:"page-link",href:"#",onClick:h(r=>a.changePage(t),["prevent"])},i(t),9,Xs)],2))),128)),e("li",{class:A(["page-item",{disabled:a.currentPage===a.totalPages}])},[e("a",{class:"page-link",href:"#",onClick:s[11]||(s[11]=h(t=>a.changePage(a.currentPage+1),["prevent"]))},[...s[60]||(s[60]=[e("i",{class:"bi bi-chevron-right"},null,-1)])])],2)])]),e("div",Ys,[s[62]||(s[62]=e("label",{class:"me-2 text-muted"},"Mostrar:",-1)),b(e("select",{class:"form-select form-select-sm",style:{width:"auto"},"onUpdate:modelValue":s[12]||(s[12]=t=>a.itemsPerPage=t)},[...s[61]||(s[61]=[e("option",{value:"10"},"10",-1),e("option",{value:"25"},"25",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)])],512),[[L,a.itemsPerPage]])])])):E("",!0)])])]),e("div",Zs,[e("div",$s,[e("div",ea,[e("div",sa,[e("h5",aa,i(a.isEditing?"Editar Usuario":"Nuevo Usuario"),1),s[63]||(s[63]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("form",{onSubmit:s[27]||(s[27]=h((...t)=>a.saveUser&&a.saveUser(...t),["prevent"]))},[e("div",ta,[e("div",oa,[e("div",la,[e("div",na,[e("img",{src:a.form.avatar||"https://ui-avatars.com/api/?name="+encodeURIComponent(a.form.name||"U")+"&background=random",class:"rounded-circle mb-3",width:"120",height:"120",style:{"object-fit":"cover"},alt:a.form.name||"Usuario"},null,8,ia),e("button",{type:"button",class:"btn btn-sm btn-primary position-absolute bottom-0 start-50 translate-middle",onClick:s[13]||(s[13]=(...t)=>a.triggerFileUpload&&a.triggerFileUpload(...t))},[...s[64]||(s[64]=[e("i",{class:"bi bi-camera"},null,-1)])]),e("input",{type:"file",ref:"avatarInput",class:"d-none",accept:"image/*",onChange:s[14]||(s[14]=(...t)=>a.handleAvatarUpload&&a.handleAvatarUpload(...t))},null,544)]),s[65]||(s[65]=e("div",{class:"text-muted small"}," Tamaño máximo: 2MB ",-1))]),e("div",ra,[e("div",da,[e("div",ca,[s[66]||(s[66]=e("label",{class:"form-label"},"Nombre",-1)),b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[15]||(s[15]=t=>a.form.name=t),required:""},null,512),[[k,a.form.name]])]),e("div",ma,[s[67]||(s[67]=e("label",{class:"form-label"},"Apellido",-1)),b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[16]||(s[16]=t=>a.form.lastName=t),required:""},null,512),[[k,a.form.lastName]])]),e("div",ua,[s[69]||(s[69]=e("label",{class:"form-label"},"Nombre de usuario",-1)),e("div",va,[s[68]||(s[68]=e("span",{class:"input-group-text"},"@",-1)),b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[17]||(s[17]=t=>a.form.username=t),required:""},null,512),[[k,a.form.username]])])]),e("div",pa,[s[70]||(s[70]=e("label",{class:"form-label"},"Correo electrónico",-1)),b(e("input",{type:"email",class:"form-control","onUpdate:modelValue":s[18]||(s[18]=t=>a.form.email=t),required:""},null,512),[[k,a.form.email]])]),e("div",ba,[s[71]||(s[71]=e("label",{class:"form-label"},"Teléfono",-1)),b(e("input",{type:"tel",class:"form-control","onUpdate:modelValue":s[19]||(s[19]=t=>a.form.phone=t)},null,512),[[k,a.form.phone]])]),e("div",ga,[s[72]||(s[72]=e("label",{class:"form-label"},"Rol",-1)),b(e("select",{class:"form-select","onUpdate:modelValue":s[20]||(s[20]=t=>a.form.role=t),required:""},[(c(!0),d(D,null,P(a.availableRoles,t=>(c(),d("option",{key:t.value,value:t.value},i(t.label),9,fa))),128))],512),[[L,a.form.role]])]),e("div",ha,[s[73]||(s[73]=e("label",{class:"form-label"},"Dirección",-1)),b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[21]||(s[21]=t=>a.form.address=t)},null,512),[[k,a.form.address]])]),e("div",wa,[s[74]||(s[74]=e("label",{class:"form-label"},"Contraseña",-1)),e("div",ya,[b(e("input",{type:a.showPassword?"text":"password",class:"form-control","onUpdate:modelValue":s[22]||(s[22]=t=>a.form.password=t),required:!a.isEditing,minlength:(a.isEditing&&a.form.password,6)},null,8,ka),[[J,a.form.password]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[23]||(s[23]=t=>a.showPassword=!a.showPassword)},[e("i",{class:A(a.showPassword?"bi bi-eye-slash":"bi bi-eye")},null,2)])]),a.isEditing?(c(),d("small",_a," Dejar en blanco para mantener la contraseña actual ")):E("",!0)]),e("div",xa,[s[75]||(s[75]=e("label",{class:"form-label"},"Confirmar Contraseña",-1)),b(e("input",{type:a.showPassword?"text":"password",class:"form-control","onUpdate:modelValue":s[24]||(s[24]=t=>a.form.password_confirmation=t),required:!a.isEditing||a.form.password,disabled:a.isEditing&&!a.form.password},null,8,Ua),[[J,a.form.password_confirmation]])]),e("div",Ca,[e("div",Da,[b(e("input",{class:"form-check-input",type:"checkbox",id:"statusSwitch","onUpdate:modelValue":s[25]||(s[25]=t=>a.form.isActive=t)},null,512),[[N,a.form.isActive]]),e("label",Pa,i(a.form.isActive?"Activo":"Inactivo"),1)])])])])]),e("div",Aa,[s[76]||(s[76]=e("h6",{class:"mb-3"},"Permisos",-1)),e("div",Sa,[(c(!0),d(D,null,P(a.availablePermissions,(t,r)=>(c(),d("div",{class:"col-md-4 mb-3",key:r},[e("div",Ea,[e("div",Ma,[e("div",za,[e("input",{class:"form-check-input",type:"checkbox",id:"permissionGroup"+r,checked:a.isPermissionGroupChecked(t.permissions),onChange:w=>a.togglePermissionGroup(t.permissions,w)},null,40,La),e("label",{class:"form-check-label fw-medium",for:"permissionGroup"+r},i(t.name),9,Na)])]),e("div",Va,[(c(!0),d(D,null,P(t.permissions,w=>(c(),d("div",{key:w.key,class:"mb-2"},[e("div",Ra,[b(e("input",{class:"form-check-input",type:"checkbox",id:"permission"+w.key,value:w.key,"onUpdate:modelValue":s[26]||(s[26]=y=>a.form.permissions=y)},null,8,Ia),[[N,a.form.permissions]]),e("label",{class:"form-check-label small",for:"permission"+w.key},i(w.label),9,ja)])]))),128))])])]))),128))])])]),e("div",Ta,[s[77]||(s[77]=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," Cancelar ",-1)),e("button",{type:"submit",class:"btn btn-primary",disabled:a.isSaving},[a.isSaving?(c(),d("span",Ga)):E("",!0),g(" "+i(a.isSaving?"Guardando...":"Guardar Cambios"),1)],8,Fa)])],32)])])]),e("div",Ba,[e("div",qa,[e("div",Oa,[s[82]||(s[82]=e("div",{class:"modal-header border-0"},[e("h5",{class:"modal-title text-danger"},[e("i",{class:"bi bi-exclamation-triangle-fill text-danger me-2"}),g(" Confirmar Eliminación ")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Qa,[e("p",null,[s[78]||(s[78]=g("¿Estás seguro de que deseas eliminar al usuario ",-1)),e("strong",null,i(a.userToDelete?a.userToDelete.name:""),1),s[79]||(s[79]=g("?",-1))]),s[80]||(s[80]=e("p",{class:"mb-0"},"Esta acción no se puede deshacer y el usuario perderá el acceso al sistema.",-1))]),e("div",Ha,[s[81]||(s[81]=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," Cancelar ",-1)),e("button",{type:"button",class:"btn btn-danger",onClick:s[28]||(s[28]=(...t)=>a.deleteUser&&a.deleteUser(...t)),disabled:a.isDeleting},[a.isDeleting?(c(),d("span",Ja)):E("",!0),g(" "+i(a.isDeleting?"Eliminando...":"Sí, eliminar"),1)],8,Ka)])])])])])}const Za=ke(Ce,[["render",Wa],["__scopeId","data-v-6d79b23e"]]);export{Za as default};
